(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[173],{3682:(e,t,r)=>{Promise.resolve().then(r.bind(r,4201))},4201:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var a=r(5155),s=r(2115),o=r(9946);let n=(0,o.A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var c=r(3861);let l=(0,o.A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var i=r(5196);let d=(0,o.A)("check-check",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);var u=r(1218),m=r(5695),h=r(7280),x=r(5077),g=r(4830);function f(){let[e,t]=(0,s.useState)([]),[r,o]=(0,s.useState)(""),[f,b]=(0,s.useState)(1),[p,v]=(0,s.useState)(!1),[k,y]=(0,s.useState)(!0),[j,w]=(0,s.useState)("disconnected"),[N,S]=(0,s.useState)(new Set),[_,A]=(0,s.useState)(!1),I=(0,s.useRef)(null),E=(0,s.useRef)(0),P=(0,s.useRef)(null),T=(0,s.useRef)(0),C=(0,s.useRef)(null),{t:M}=(0,u.Bd)(),R=(0,m.useRouter)(),{theme:z}=(0,h.D)(),L=(0,s.useRef)(new Set);(0,s.useEffect)(()=>{let e=localStorage.getItem("markedAsReadNotifications");if(e)try{let t=JSON.parse(e);L.current=new Set(t)}catch(e){console.error("Failed to parse cached read notifications",e),localStorage.removeItem("markedAsReadNotifications")}},[]);let O=e=>{L.current.add(e),localStorage.setItem("markedAsReadNotifications",JSON.stringify(Array.from(L.current)))},W=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=localStorage.getItem("accessToken");if(!r){console.error("No access token found"),o("Please log in to view notifications");return}let a=Date.now();if(!(a-T.current<1e3)||1!==e){T.current=a;try{var s;v(!0);let a=await x.A.get("/blaffa/notification?page=".concat(e),{headers:{Authorization:"Bearer ".concat(r)}});if(200!==a.status)throw Error("HTTP ".concat(a.status));let n=await a.data;if((null==n||null==(s=n.results)?void 0:s.length)>0){let r=n.results.map(e=>({id:e.id,title:e.title,content:e.content,created_at:e.created_at,is_read:e.is_read||L.current.has(e.id)}));1===e?t(r):t(e=>[...e,...r]),y(null!==n.next)}else 1===e&&t([]),y(!1);o(null)}catch(e){console.error("Failed to load notifications:",e),o("Failed to load notifications"),y(!1)}finally{v(!1)}}},B=e=>{try{return t(t=>t.map(t=>t.id===e?{...t,is_read:!0}:t)),O(e),console.log("Notification ".concat(e," marked as read locally")),!0}catch(e){return console.error("Failed to mark notification as read locally:",e),!1}},F=e=>{let t=new Set(N);t.has(e)?t.delete(e):t.add(e),S(t)},D=e=>{let t=new Date(e),r=new Date().getTime()-t.getTime(),a=Math.floor(r/6e4),s=Math.floor(r/36e5),o=Math.floor(r/864e5);return a<1?"Just now":a<60?"".concat(a,"m ago"):s<24?"".concat(s,"h ago"):o<7?"".concat(o,"d ago"):t.toLocaleDateString()},q=()=>{let e=localStorage.getItem("accessToken");if(!e){console.error("No access token found for WebSocket connection"),o(M("You must be logged in to receive real-time updates.")),w("error");return}try{I.current&&(I.current.pingInterval&&clearInterval(I.current.pingInterval),I.current.close());let r="wss://api.blaffa.net/ws/socket?token=".concat(encodeURIComponent(e));I.current=new WebSocket(r),I.current.onopen=()=>{console.log("WebSocket connected successfully"),w("connected"),o(null),E.current=0,I.current.pingInterval=setInterval(()=>{I.current&&I.current.readyState===WebSocket.OPEN&&I.current.send(JSON.stringify({type:"ping"}))},3e4)},I.current.onmessage=e=>{try{let r=JSON.parse(e.data);if("pong"===r.type)return;let a={id:r.id,title:r.title,content:r.content,created_at:r.created_at,is_read:r.is_read||L.current.has(r.id)};t(e=>[a,...e])}catch(e){console.error("Error processing WebSocket message:",e)}},I.current.onerror=e=>{console.error("WebSocket error:",e),w("error")},I.current.onclose=()=>{w("disconnected");let e=Math.min(3e4,1e3*Math.pow(2,E.current));P.current=setTimeout(()=>{E.current++,q()},e)}}catch(e){console.error("Failed to setup WebSocket:",e),w("error")}},J=e=>{!p&&(C.current&&C.current.disconnect(),C.current=new IntersectionObserver(e=>{e[0].isIntersecting&&k&&(b(e=>e+1),W(f+1))}),e&&C.current.observe(e))};(0,s.useEffect)(()=>(W(1),q(),()=>{I.current&&(I.current.pingInterval&&clearInterval(I.current.pingInterval),I.current.close()),P.current&&clearTimeout(P.current),C.current&&C.current.disconnect()}),[]);let H=e.filter(e=>!e.is_read).length;return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br ".concat(z.colors.a_background),children:[(0,a.jsx)(g.A,{}),(0,a.jsx)("div",{className:"bg-gradient-to-br ".concat(z.colors.a_background," shadow-sm border-b border-gray-200 dark:border-gray-700"),children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("button",{onClick:()=>R.back(),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",children:(0,a.jsx)(n,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(c.A,{className:"h-6 w-6"}),(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Notifications"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"flex items-center space-x-1 text-sm text-gray-500"}),(0,a.jsx)("button",{onClick:()=>W(1),disabled:p,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full disabled:opacity-50",children:(0,a.jsx)(l,{className:"h-4 w-4 ".concat(p?"animate-spin":"")})})]})]})})}),e.length>0&&(0,a.jsx)("div",{className:" bg-gradient-to-br ".concat(z.colors.s_background," border-b border-gray-200 dark:border-gray-700"),children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("button",{onClick:()=>{A(!_),S(new Set)},className:"text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",children:_?"Annuler":"S\xe9lectionner"}),_&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>{S(new Set(e.map(e=>e.id)))},className:"text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200",children:"S\xe9lectionner tout"}),(0,a.jsx)("button",{onClick:()=>{S(new Set)},className:"text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200",children:"Clair"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[_&&N.size>0&&(0,a.jsxs)("button",{onClick:()=>{try{return t(e=>e.map(e=>N.has(e.id)?{...e,is_read:!0}:e)),N.forEach(e=>{O(e)}),S(new Set),A(!1),console.log("Selected notifications marked as read locally"),!0}catch(e){return console.error("Failed to mark selected notifications as read locally:",e),!1}},className:"flex items-center space-x-1 px-3 py-1 bg-blue-600 text-white rounded-full text-sm hover:bg-blue-700",children:[(0,a.jsx)(i.A,{className:"h-3 w-3"}),(0,a.jsxs)("span",{children:["Marquer comme lu (",N.size,")"]})]}),H>0&&(0,a.jsxs)("button",{onClick:()=>{try{return t(e=>e.map(e=>({...e,is_read:!0}))),e.forEach(e=>{O(e.id)}),console.log("All notifications marked as read locally"),!0}catch(e){return console.error("Failed to mark all notifications as read locally:",e),!1}},className:"flex items-center space-x-1 px-3 py-1 bg-green-600 text-white rounded-full text-sm hover:bg-green-700",children:[(0,a.jsx)(d,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:"Mark All Read"})]})]})]})})}),(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-6",children:[r&&(0,a.jsx)("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:(0,a.jsx)("p",{className:"text-red-600 dark:text-red-400",children:r})}),p&&0===e.length?(0,a.jsx)("div",{className:"flex justify-center py-8",children:(0,a.jsx)(l,{className:"h-6 w-6 animate-spin text-gray-400"})}):0===e.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(c.A,{className:"h-12 w-12  mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No notifications yet"}),(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"When you receive notifications, they'll appear here."})]}):(0,a.jsxs)("div",{className:"space-y-2",children:[e.map((t,r)=>(0,a.jsxs)("div",{ref:r===e.length-1?J:null,className:"relative bg-gradient-to-br ".concat(z.colors.background," rounded-lg border ").concat(t.is_read?"border-gray-200 dark:border-gray-700":"border-orange-200 dark:border-orange-800 bg-orange-50 dark:bg-orange-900/10"," p-4 hover:shadow-md transition-shadow cursor-pointer ").concat(N.has(t.id)?"ring-2 ring-blue-500":""),onClick:()=>{_?F(t.id):t.is_read||B(t.id)},children:[(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[_&&(0,a.jsx)("div",{className:"flex-shrink-0 mt-1",children:(0,a.jsx)("input",{type:"checkbox",checked:N.has(t.id),onChange:()=>F(t.id),className:"h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-sm font-medium ".concat(t.is_read?"".concat(z.colors.text):"".concat(z.colors.text," font-semibold")),children:t.title}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:D(t.created_at)}),!t.is_read&&(0,a.jsx)("div",{className:"w-2 h-2 bg-orange-500 rounded-full"})]})]}),(0,a.jsx)("p",{className:"mt-1 text-sm ".concat((t.is_read,"".concat(z.colors.text))),children:t.content})]})]}),!_&&!t.is_read&&(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),B(t.id)},className:"absolute top-4 right-4 p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)(i.A,{className:"h-4 w-4 text-gray-400 hover:text-green-600"})})]},t.id)),p&&k&&(0,a.jsx)("div",{className:"flex justify-center py-4",children:(0,a.jsx)(l,{className:"h-6 w-6 animate-spin text-gray-400"})})]})]})]})}},4830:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var a=r(5155),s=r(2115),o=r(3861),n=r(1007),c=r(6766),l=r(7280);let i=()=>{let{theme:e,toggleTheme:t}=(0,l.D)();return(0,a.jsx)("button",{onClick:t,className:"flex items-center justify-center p-2 rounded-full",style:{backgroundColor:"dark"===e.mode?"#374151":"#e5e7eb"},"aria-label":"Switch to ".concat("light"===e.mode?"dark":"light"," mode"),children:"light"===e.mode?(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})}):(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})})})};var d=r(1218);let u=()=>{let[e,t]=(0,s.useState)(!1),{t:r}=(0,d.Bd)();return(0,s.useEffect)(()=>{setTimeout(()=>{setTimeout(()=>{},5e3)},3e3)},[]),(0,s.useEffect)(()=>{let r=r=>{e&&r.target instanceof Element&&!r.target.closest(".mobile-menu-container")&&t(!1)};return document.addEventListener("click",r),()=>document.removeEventListener("click",r)},[e]),(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("header",{className:"backdrop-blur-lg border-b border-black/20 sticky top-0 z-50 overflow-x-hidden",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 w-full",children:(0,a.jsxs)("div",{className:"flex items-center justify-between h-16 w-full overflow-x-hidden",children:[(0,a.jsx)("div",{className:"flex items-center space-x-4 flex-shrink-0",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(c.default,{src:"/logo.png",alt:"Logo",width:40,height:40,className:"rounded-full"}),(0,a.jsx)("span",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-blue-600 bg-clip-text text-transparent",children:"Blaffa"})]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-4 flex-shrink-0",children:[(0,a.jsx)("a",{href:"/notifications",className:"relative p-2 hover:text-gray-900 hover:bg-gray-100 rounded-full transition-colors",children:(0,a.jsx)(o.A,{className:"h-5 w-5 sm:h-6 sm:w-6"})}),(0,a.jsxs)("a",{className:"w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center relative group",href:"/profile",children:[(0,a.jsx)(n.A,{size:16,className:"text-sm text-white font-bold group-hover:scale-110 transition-transform"}),(0,a.jsx)("div",{className:"absolute inset-0 bg-blue-500 rounded-full animate-ping opacity-75 duration-1000 hidden group-hover:block"})]}),(0,a.jsx)("div",{className:"w-8 h-8",children:(0,a.jsx)(i,{})})]})]})})})})}},5077:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var a=r(3464);let s="https://api.blaffa.net",o=a.A.create({baseURL:s,headers:{"Content-Type":"application/json"}}),n=!1,c=[],l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;c.forEach(r=>{e?r.reject(e):r.resolve(t)}),c=[]};o.interceptors.request.use(e=>{let t=localStorage.getItem("accessToken");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),o.interceptors.response.use(e=>e,async e=>{var t;let r=e.config;if((null==(t=e.response)?void 0:t.status)===401&&!r._retry){if(n)return new Promise((e,t)=>{c.push({resolve:e,reject:t})}).then(e=>(r.headers.Authorization="Bearer ".concat(e),o(r))).catch(e=>Promise.reject(e));r._retry=!0,n=!0;try{let t=localStorage.getItem("refreshToken");if(!t)return localStorage.removeItem("accessToken"),window.location.href="/auth",Promise.reject(e);let{access:n,refresh:c}=(await a.A.post("".concat(s,"/auth/refresh"),{refresh:t},{headers:{"Content-Type":"application/json"}})).data;return localStorage.setItem("accessToken",n),c&&localStorage.setItem("refreshToken",c),o.defaults.headers.common.Authorization="Bearer ".concat(n),r.headers.Authorization="Bearer ".concat(n),l(null,n),o(r)}catch(e){return console.error("Failed to refresh token:",e),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.location.href="/auth",l(e),Promise.reject(e)}finally{n=!1}}return Promise.reject(e)});let i=o},5196:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(9946).A)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},5695:(e,t,r)=>{"use strict";var a=r(8999);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},7280:(e,t,r)=>{"use strict";r.d(t,{D:()=>l,N:()=>c});var a=r(5155),s=r(2115);let o={light:{mode:"light",colors:{primary:"#0070f3",secondary:"#0ea5e9",s_text:"text-blue-600",d_text:"text-slate-900",s_background:"from-slate-100/80 to-slate-200/80",sl_background:"bg-slate-100",c_background:"bg-slate-100/50",a_background:"from-slate-100 via-blue-100 to-slate-50",background:"bg-slate-50",text:"#1f2937",accent:"#8b5cf6",hover:"hover:bg-gray-100"},values:{borderRadius:"0.5rem",fontSizes:{small:"0.875rem",medium:"1rem",large:"1.25rem"},spacing:{small:"0.5rem",medium:"1rem",large:"2rem"}}},dark:{mode:"dark",colors:{primary:"#3b82f6",secondary:"#0ea5e9",s_text:"text-blue-300",d_text:"text-slate-300",s_background:"from-slate-800/80 to-slate-700/80",sl_background:"bg-slate-900",c_background:"bg-slate-800/50",a_background:"from-slate-900 via-blue-900 to-slate-800",background:"bg-slate-800",text:"#f9fafb",accent:"#a78bfa",hover:"hover:bg-gray-700"},values:{borderRadius:"0.5rem",fontSizes:{small:"0.875rem",medium:"1rem",large:"1.25rem"},spacing:{small:"0.5rem",medium:"1rem",large:"2rem"}}}},n=(0,s.createContext)(void 0),c=e=>{let{children:t}=e,[r,c]=(0,s.useState)("light"),[l,i]=(0,s.useState)(!1),d=e=>{c(e),l&&(localStorage.setItem("theme",e),u(e))},u=e=>{let t=document.documentElement,r=o[e];if(!r||!r.colors||!r.values)return void console.warn("Theme '".concat(e,"' not found or incomplete"));Object.entries(r.colors).forEach(e=>{let[r,a]=e;"string"==typeof a&&a.startsWith("#")&&t.style.setProperty("--color-".concat(r),a)}),t.style.setProperty("--border-radius",r.values.borderRadius),Object.entries(r.values.fontSizes).forEach(e=>{let[r,a]=e;t.style.setProperty("--font-size-".concat(r),a)}),Object.entries(r.values.spacing).forEach(e=>{let[r,a]=e;t.style.setProperty("--spacing-".concat(r),a)}),t.setAttribute("data-theme",e)};if((0,s.useEffect)(()=>{let e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches,r=e||(t?"dark":"light");c(r),u(r),i(!0);let a=window.matchMedia("(prefers-color-scheme: dark)"),s=e=>{if(!localStorage.getItem("theme")){let t=e.matches?"dark":"light";c(t),u(t)}};return a.addEventListener("change",s),()=>a.removeEventListener("change",s)},[]),!l)return null;let m=o[r];return m?(0,a.jsx)(n.Provider,{value:{theme:m,setTheme:d,toggleTheme:()=>{d("light"===r?"dark":"light")}},children:(0,a.jsx)("div",{className:"".concat(r,"-theme"),children:t})}):(console.error("Invalid theme mode: ".concat(r)),null)},l=()=>{let e=(0,s.useContext)(n);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[218,464,928,441,684,358],()=>t(3682)),_N_E=e.O()}]);